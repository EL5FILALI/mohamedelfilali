<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GramaScoR - Primaire</title>
    <style>
        body {
            margin: 0;
            font-family: 'Arial', sans-serif;
            background: #f1f8e9;
            min-height: 100vh;
            padding: 20px;
            color: #33691e;
        }
        h1 {
            text-align: center;
            font-size: 2.8em;
            margin-bottom: 30px;
        }
        .activity-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .activity {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s;
            border: 1px solid #dcedc8;
        }
        .activity:hover { transform: translateY(-5px); }
        h2 {
            margin: 0 0 10px;
            font-size: 1.5em;
            color: #558b2f;
        }
        p {
            margin: 0 0 15px;
            font-size: 1.1em;
        }
        .draggable, .option, textarea, input {
            padding: 10px;
            margin: 5px;
            background: #aed581;
            border-radius: 5px;
            border: none;
            font-size: 1em;
        }
        .draggable { cursor: grab; }
        .drop-zone {
            width: 80px;
            height: 40px;
            border: 2px dashed #33691e;
            margin: 5px;
            text-align: center;
            line-height: 40px;
            display: inline-block;
        }
        .drop-zone.correct { background: #a5d6a7; }
        .option { cursor: pointer; }
        .option:hover { background: #9ccc65; }
        button {
            padding: 10px 20px;
            background: #689f38;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #558b2f; }
        .feedback {
            margin-top: 10px;
            font-size: 1.1em;
            text-align: center;
            display: none;
        }
        .recall {
            display: none;
            padding: 10px;
            background: #dcedc8;
            border-radius: 5px;
            margin-top: 10px;
        }
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            pointer-events: none;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        @keyframes fall {
            to { transform: translateY(100vh); }
        }
    </style>
</head>
<body>
    <a href="index.html" style="position: absolute; top: 20px; left: 20px; color: #33691e; font-size: 1.2em; text-decoration: none;">← Retour</a>
    <h1>GramaScoR - Niveau Primaire</h1>
    <audio id="successSound" src="https://www.soundjay.com/buttons/beep-01a.mp3"></audio>
    <div class="activity-container">
        <div class="activity" id="act1">
            <h2>Chasse aux mots</h2>
            <p>Glisse les mots dans les bonnes boîtes :</p>
            <div class="task">
                <span class="draggable" draggable="true">Une</span>
                <span class="draggable" draggable="true">fleur</span>
                <span class="draggable" draggable="true">pousse</span>
            </div>
            <div>
                <div class="drop-zone" data-type="determinant">Déterminant</div>
                <div class="drop-zone" data-type="nom">Nom</div>
                <div class="drop-zone" data-type="verbe">Verbe</div>
            </div>
            <div class="feedback"></div>
            <button onclick="showRecall(this)">Fiche de rappel</button>
            <button onclick="newChallenge(this, 'act1')">Nouveau défi</button>
            <div class="recall">Un <strong>déterminant</strong> introduit le nom (ex. : une, le). Un <strong>nom</strong> désigne une chose ou une personne (ex. : fleur). Un <strong>verbe</strong> indique une action (ex. : pousse).</div>
        </div>

        <div class="activity" id="act2">
            <h2>Complète la phrase</h2>
            <p>Choisis la bonne forme : Les ___ jouent.</p>
            <div class="task">
                <span class="option" data-answer="chats">chats</span>
                <span class="option" data-answer="chat">chat</span>
            </div>
            <div class="feedback"></div>
            <button onclick="showRecall(this)">Fiche de rappel</button>
            <button onclick="newChallenge(this, 'act2')">Nouveau défi</button>
            <div class="recall">Le <strong>verbe</strong> s’accorde avec le sujet en nombre : "Les chats jouent" (pluriel).</div>
        </div>

        <div class="activity" id="act3">
            <h2>Remets dans l’ordre</h2>
            <p>Reforme la phrase :</p>
            <div class="task">
                <span class="draggable" draggable="true">Le</span>
                <span class="draggable" draggable="true">chien</span>
                <span class="draggable" draggable="true">aboie</span>
            </div>
            <div class="drop-zone" style="width: 200px;"></div>
            <div class="feedback"></div>
            <button onclick="showRecall(this)">Fiche de rappel</button>
            <button onclick="newChallenge(this, 'act3')">Nouveau défi</button>
            <div class="recall">Une phrase simple a un <strong>sujet</strong> (qui fait l’action) et un <strong>verbe</strong> (l’action).</div>
        </div>

        <div class="activity" id="act4">
            <h2>Roue du temps</h2>
            <p>"Je mange" est au :</p>
            <div class="task">
                <span class="option" data-answer="présent">présent</span>
                <span class="option" data-answer="passé">passé</span>
            </div>
            <div class="feedback"></div>
            <button onclick="showRecall(this)">Fiche de rappel</button>
            <button onclick="newChallenge(this, 'act4')">Nouveau défi</button>
            <div class="recall">Le <strong>présent</strong> décrit ce qui se passe maintenant (ex. : je mange).</div>
        </div>

        <div class="activity" id="act5">
            <h2>Trouve le nom</h2>
            <p>Quel mot est un nom ?</p>
            <div class="task">
                <span class="option" data-answer="livre">livre</span>
                <span class="option" data-answer="lit">lit (verbe)</span>
            </div>
            <div class="feedback"></div>
            <button onclick="showRecall(this)">Fiche de rappel</button>
            <button onclick="newChallenge(this, 'act5')">Nouveau défi</button>
            <div class="recall">Un <strong>nom</strong> désigne une chose ou une personne (ex. : livre).</div>
        </div>

        <div class="activity" id="act6">
            <h2>Accorde l’adjectif</h2>
            <p>Complète : Une fleur ___</p>
            <div class="task">
                <input type="text" placeholder="Tape ici">
                <button onclick="checkInput(this, 'jolie')">Vérifier</button>
            </div>
            <div class="feedback"></div>
            <button onclick="showRecall(this)">Fiche de rappel</button>
            <button onclick="newChallenge(this, 'act6')">Nouveau défi</button>
            <div class="recall">L’<strong>adjectif</strong> s’accorde en genre et en nombre avec le nom (ex. : une fleur jolie).</div>
        </div>

        <div class="activity" id="act7">
            <h2>Phrase ou pas ?</h2>
            <p>Est-ce une phrase ? "Le soleil."</p>
            <div class="task">
                <span class="option" data-answer="non">Non</span>
                <span class="option" data-answer="oui">Oui</span>
            </div>
            <div class="feedback"></div>
            <button onclick="showRecall(this)">Fiche de rappel</button>
            <button onclick="newChallenge(this, 'act7')">Nouveau défi</button>
            <div class="recall">Une <strong>phrase</strong> a un sujet et un verbe (ex. : Le soleil brille).</div>
        </div>

        <div class="activity" id="act8">
            <h2>Verbe mystère</h2>
            <p>Quel est le verbe ? "Les oiseaux chantent."</p>
            <div class="task">
                <input type="text" placeholder="Tape ici">
                <button onclick="checkInput(this, 'chantent')">Vérifier</button>
            </div>
            <div class="feedback"></div>
            <button onclick="showRecall(this)">Fiche de rappel</button>
            <button onclick="newChallenge(this, 'act8')">Nouveau défi</button>
            <div class="recall">Le <strong>verbe</strong> exprime l’action (ex. : chantent).</div>
        </div>

        <div class="activity" id="act9">
            <h2>Mot magique</h2>
            <p>Ajoute "pas" : "Je mange."</p>
            <div class="task">
                <input type="text" placeholder="Tape ici">
                <button onclick="checkInput(this, 'je ne mange pas')">Vérifier</button>
            </div>
            <div class="feedback"></div>
            <button onclick="showRecall(this)">Fiche de rappel</button>
            <button onclick="newChallenge(this, 'act9')">Nouveau défi</button>
            <div class="recall">Pour nier, on ajoute <strong>ne…pas</strong> autour du verbe.</div>
        </div>

        <div class="activity" id="act10">
            <h2>Dessine ta phrase</h2>
            <p>Écris une phrase avec "chat" :</p>
            <div class="task">
                <textarea placeholder="Tape ici"></textarea>
                <button onclick="checkSentence(this)">Vérifier</button>
            </div>
            <div class="feedback"></div>
            <button onclick="showRecall(this)">Fiche de rappel</button>
            <button onclick="newChallenge(this, 'act10')">Nouveau défi</button>
            <div class="recall">Une phrase a un <strong>sujet</strong> et un <strong>verbe</strong> (ex. : Le chat dort).</div>
        </div>
    </div>

    <script>
        const challenges = {
            act1: [
                { task: ['Une', 'fleur', 'pousse'], answers: { determinant: 'Une', nom: 'fleur', verbe: 'pousse' } },
                { task: ['Le', 'soleil', 'brille'], answers: { determinant: 'Le', nom: 'soleil', verbe: 'brille' } },
                { task: ['Un', 'oiseau', 'chante'], answers: { determinant: 'Un', nom: 'oiseau', verbe: 'chante' } },
                { task: ['La', 'lune', 'luit'], answers: { determinant: 'La', nom: 'lune', verbe: 'luit' } },
                { task: ['Des', 'enfants', 'rient'], answers: { determinant: 'Des', nom: 'enfants', verbe: 'rient' } }
            ],
            act2: [
                { task: 'Les ___ jouent.', answers: { correct: 'chats', wrong: 'chat' } },
                { task: 'Les ___ volent.', answers: { correct: 'oiseaux', wrong: 'oiseau' } },
                { task: 'Les ___ dansent.', answers: { correct: 'enfants', wrong: 'enfant' } },
                { task: 'Les ___ nagent.', answers: { correct: 'poissons', wrong: 'poisson' } },
                { task: 'Les ___ sautent.', answers: { correct: 'lapins', wrong: 'lapin' } }
            ],
            act3: [
                { task: ['Le', 'chien', 'aboie'], answer: 'Le chien aboie' },
                { task: ['La', 'chatte', 'dort'], answer: 'La chatte dort' },
                { task: ['Un', 'oiseau', 'vole'], answer: 'Un oiseau vole' },
                { task: ['Les', 'fleurs', 'poussent'], answer: 'Les fleurs poussent' },
                { task: ['Une', 'étoile', 'brille'], answer: 'Une étoile brille' }
            ],
            act4: [
                { task: '"Je mange" est au :', answers: { correct: 'présent', wrong: 'passé' } },
                { task: '"Il court" est au :', answers: { correct: 'présent', wrong: 'futur' } },
                { task: '"Nous jouons" est au :', answers: { correct: 'présent', wrong: 'passé' } },
                { task: '"Elle danse" est au :', answers: { correct: 'présent', wrong: 'futur' } },
                { task: '"Tu ris" est au :', answers: { correct: 'présent', wrong: 'passé' } }
            ],
            act5: [
                { task: 'Quel mot est un nom ?', answers: { correct: 'livre', wrong: 'lit' } },
                { task: 'Quel mot est un nom ?', answers: { correct: 'chat', wrong: 'dort' } },
                { task: 'Quel mot est un nom ?', answers: { correct: 'fleur', wrong: 'pousse' } },
                { task: 'Quel mot est un nom ?', answers: { correct: 'soleil', wrong: 'brille' } },
                { task: 'Quel mot est un nom ?', answers: { correct: 'étoile', wrong: 'luit' } }
            ],
            act6: [
                { task: 'Une fleur ___', answer: 'jolie' },
                { task: 'Un chien ___', answer: 'gentil' },
                { task: 'Une maison ___', answer: 'grande' },
                { task: 'Un oiseau ___', answer: 'coloré' },
                { task: 'Une étoile ___', answer: 'brillante' }
            ],
            act7: [
                { task: 'Est-ce une phrase ? "Le soleil."', answers: { correct: 'non', wrong: 'oui' } },
                { task: 'Est-ce une phrase ? "La lune brille."', answers: { correct: 'oui', wrong: 'non' } },
                { task: 'Est-ce une phrase ? "Un chat."', answers: { correct: 'non', wrong: 'oui' } },
                { task: 'Est-ce une phrase ? "Les enfants jouent."', answers: { correct: 'oui', wrong: 'non' } },
                { task: 'Est-ce une phrase ? "Une fleur rouge."', answers: { correct: 'non', wrong: 'oui' } }
            ],
            act8: [
                { task: 'Quel est le verbe ? "Les oiseaux chantent."', answer: 'chantent' },
                { task: 'Quel est le verbe ? "Le chien aboie."', answer: 'aboie' },
                { task: 'Quel est le verbe ? "La fleur pousse."', answer: 'pousse' },
                { task: 'Quel est le verbe ? "Un enfant rit."', answer: 'rit' },
                { task: 'Quel est le verbe ? "Le soleil brille."', answer: 'brille' }
            ],
            act9: [
                { task: 'Ajoute "pas" : "Je mange."', answer: 'je ne mange pas' },
                { task: 'Ajoute "pas" : "Il court."', answer: 'il ne court pas' },
                { task: 'Ajoute "pas" : "Nous jouons."', answer: 'nous ne jouons pas' },
                { task: 'Ajoute "pas" : "Elle dort."', answer: 'elle ne dort pas' },
                { task: 'Ajoute "pas" : "Tu ris."', answer: 'tu ne ris pas' }
            ],
            act10: [
                { task: 'Écris une phrase avec "chat" :', keyword: 'chat' },
                { task: 'Écris une phrase avec "soleil" :', keyword: 'soleil' },
                { task: 'Écris une phrase avec "fleur" :', keyword: 'fleur' },
                { task: 'Écris une phrase avec "oiseau" :', keyword: 'oiseau' },
                { task: 'Écris une phrase avec "étoile" :', keyword: 'étoile' }
            ]
        };

        function showConfetti() {
            for (let i = 0; i < 20; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * window.innerWidth + 'px';
                confetti.style.top = '-10px';
                confetti.style.background = ['#ff0', '#f00', '#0f0'][Math.floor(Math.random() * 3)];
                confetti.style.animation = 'fall 2s linear';
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 2000);
            }
        }

        const draggables = document.querySelectorAll('.draggable');
        const dropZones = document.querySelectorAll('.drop-zone');
        draggables.forEach(d => {
            d.addEventListener('dragstart', (e) => e.dataTransfer.setData('text', e.target.textContent));
        });
        dropZones.forEach(z => {
            z.addEventListener('dragover', (e) => e.preventDefault());
            z.addEventListener('drop', (e) => {
                e.preventDefault();
                const word = e.dataTransfer.getData('text');
                const type = z.dataset.type || 'phrase';
                const activity = z.closest('.activity');
                const feedback = activity.querySelector('.feedback');
                const currentChallenge = challenges[activity.id][activity.dataset.challenge || 0];
                let isCorrect = false;

                if (type === 'determinant' && word === currentChallenge.answers.determinant) isCorrect = true;
                if (type === 'nom' && word === currentChallenge.answers.nom) isCorrect = true;
                if (type === 'verbe' && word === currentChallenge.answers.verbe) isCorrect = true;
                if (type === 'phrase' && z.textContent === '' && word === currentChallenge.answer.split(' ')[0]) isCorrect = true;
                if (type === 'phrase' && z.textContent === currentChallenge.answer.split(' ')[0] && word === currentChallenge.answer.split(' ')[1]) isCorrect = true;
                if (type === 'phrase' && z.textContent === currentChallenge.answer.split(' ').slice(0, 2).join(' ') && word === currentChallenge.answer.split(' ')[2]) isCorrect = true;

                if (isCorrect) {
                    z.textContent = type === 'phrase' ? `${z.textContent} ${word}`.trim() : word;
                    z.classList.add('correct');
                    z.style.animation = 'bounce 0.5s';
                    feedback.style.display = 'block';
                    feedback.style.color = '#33691e';
                    feedback.textContent = 'Super !';
                    document.getElementById('successSound').play();
                    showConfetti();
                } else {
                    feedback.style.display = 'block';
                    feedback.style.color = '#d32f2f';
                    feedback.textContent = 'Réessaie !';
                }
            });
        });

        const options = document.querySelectorAll('.option');
        options.forEach(o => {
            o.addEventListener('click', () => {
                const activity = o.closest('.activity');
                const feedback = activity.querySelector('.feedback');
                const answer = o.dataset.answer;
                const currentChallenge = challenges[activity.id][activity.dataset.challenge || 0];
                const isCorrect = answer === currentChallenge.answers.correct;

                if (isCorrect) {
                    o.style.background = '#a5d6a7';
                    feedback.style.display = 'block';
                    feedback.style.color = '#33691e';
                    feedback.textContent = 'Bravo !';
                    document.getElementById('successSound').play();
                    showConfetti();
                } else {
                    o.style.background = '#ef9a9a';
                    feedback.style.display = 'block';
                    feedback.style.color = '#d32f2f';
                    feedback.textContent = 'Non, réessaie !';
                }
            });
        });

        function checkInput(btn, correct) {
            const activity = btn.closest('.activity');
            const input = btn.previousElementSibling;
            const feedback = activity.querySelector('.feedback');
            const currentChallenge = challenges[activity.id][activity.dataset.challenge || 0];
            if (input.value.toLowerCase().trim() === currentChallenge.answer) {
                input.style.background = '#a5d6a7';
                feedback.style.display = 'block';
                feedback.style.color = '#33691e';
                feedback.textContent = 'Parfait !';
                document.getElementById('successSound').play();
                showConfetti();
            } else {
                input.style.background = '#ef9a9a';
                feedback.style.display = 'block';
                feedback.style.color = '#d32f2f';
                feedback.textContent = `Non, c’est "${currentChallenge.answer}".`;
            }
        }

        function checkSentence(btn) {
            const activity = btn.closest('.activity');
            const textarea = btn.previousElementSibling;
            const feedback = activity.querySelector('.feedback');
            const currentChallenge = challenges[activity.id][activity.dataset.challenge || 0];
            const text = textarea.value.toLowerCase().trim();
            if (text.includes(currentChallenge.keyword) && text.split(' ').length > 1) {
                textarea.style.background = '#a5d6a7';
                feedback.style.display = 'block';
                feedback.style.color = '#33691e';
                feedback.textContent = 'Joli travail !';
                document.getElementById('successSound').play();
                showConfetti();
            } else {
                textarea.style.background = '#ef9a9a';
                feedback.style.display = 'block';
                feedback.style.color = '#d32f2f';
                feedback.textContent = `Ajoute "${currentChallenge.keyword}" et un verbe !`;
            }
        }

        function showRecall(btn) {
            const recall = btn.nextElementSibling.nextElementSibling;
            recall.style.display = recall.style.display === 'block' ? 'none' : 'block';
        }

        function newChallenge(btn, actId) {
            const activity = document.getElementById(actId);
            const currentIndex = parseInt(activity.dataset.challenge || 0);
            const newIndex = (currentIndex + 1) % 5;
            activity.dataset.challenge = newIndex;
            const challenge = challenges[actId][newIndex];
            const p = activity.querySelector('p');
            const taskDiv = activity.querySelector('.task');
            taskDiv.innerHTML = '';
            activity.querySelector('.feedback').style.display = 'none';

            if (actId === 'act1' || actId === 'act3') {
                p.textContent = actId === 'act1' ? 'Glisse les mots dans les bonnes boîtes :' : 'Reforme la phrase :';
                challenge.task.forEach(word => {
                    const span = document.createElement('span');
                    span.className = 'draggable';
                    span.draggable = true;
                    span.textContent = word;
                    span.addEventListener('dragstart', (e) => e.dataTransfer.setData('text', e.target.textContent));
                    taskDiv.appendChild(span);
                });
                if (actId === 'act1') {
                    taskDiv.nextElementSibling.innerHTML = '<div class="drop-zone" data-type="determinant">Déterminant</div><div class="drop-zone" data-type="nom">Nom</div><div class="drop-zone" data-type="verbe">Verbe</div>';
                } else {
                    taskDiv.nextElementSibling.innerHTML = '<div class="drop-zone" style="width: 200px;"></div>';
                }
                const newZones = taskDiv.nextElementSibling.querySelectorAll('.drop-zone');
                newZones.forEach(z => {
                    z.addEventListener('dragover', (e) => e.preventDefault());
                    z.addEventListener('drop', (e) => {
                        e.preventDefault();
                        const word = e.dataTransfer.getData('text');
                        const type = z.dataset.type || 'phrase';
                        const feedback = activity.querySelector('.feedback');
                        let isCorrect = false;

                        if (type === 'determinant' && word === challenge.answers.determinant) isCorrect = true;
                        if (type === 'nom' && word === challenge.answers.nom) isCorrect = true;
                        if (type === 'verbe' && word === challenge.answers.verbe) isCorrect = true;
                        if (type === 'phrase' && z.textContent === '' && word === challenge.answer.split(' ')[0]) isCorrect = true;
                        if (type === 'phrase' && z.textContent === challenge.answer.split(' ')[0] && word === challenge.answer.split(' ')[1]) isCorrect = true;
                        if (type === 'phrase' && z.textContent === challenge.answer.split(' ').slice(0, 2).join(' ') && word === challenge.answer.split(' ')[2]) isCorrect = true;

                        if (isCorrect) {
                            z.textContent = type === 'phrase' ? `${z.textContent} ${word}`.trim() : word;
                            z.classList.add('correct');
                            z.style.animation = 'bounce 0.5s';
                            feedback.style.display = 'block';
                            feedback.style.color = '#33691e';
                            feedback.textContent = 'Super !';
                            document.getElementById('successSound').play();
                            showConfetti();
                        } else {
                            feedback.style.display = 'block';
                            feedback.style.color = '#d32f2f';
                            feedback.textContent = 'Réessaie !';
                        }
                    });
                });
            } else if (actId === 'act2' || actId === 'act4' || actId === 'act5' || actId === 'act7') {
                p.textContent = challenge.task;
                const span1 = document.createElement('span');
                span1.className = 'option';
                span1.dataset.answer = challenge.answers.correct;
                span1.textContent = challenge.answers.correct;
                const span2 = document.createElement('span');
                span2.className = 'option';
                span2.dataset.answer = challenge.answers.wrong;
                span2.textContent = challenge.answers.wrong;
                taskDiv.appendChild(span1);
                taskDiv.appendChild(span2);
                [span1, span2].forEach(o => {
                    o.addEventListener('click', () => {
                        const feedback = activity.querySelector('.feedback');
                        const isCorrect = o.dataset.answer === challenge.answers.correct;
                        if (isCorrect) {
                            o.style.background = '#a5d6a7';
                            feedback.style.display = 'block';
                            feedback.style.color = '#33691e';
                            feedback.textContent = 'Bravo !';
                            document.getElementById('successSound').play();
                            showConfetti();
                        } else {
                            o.style.background = '#ef9a9a';
                            feedback.style.display = 'block';
                            feedback.style.color = '#d32f2f';
                            feedback.textContent = 'Non, réessaie !';
                        }
                    });
                });
            } else if (actId === 'act6' || actId === 'act8' || actId === 'act9') {
                p.textContent = challenge.task;
                const input = document.createElement('input');
                input.type = 'text';
                input.placeholder = 'Tape ici';
                const button = document.createElement('button');
                button.textContent = 'Vérifier';
                button.onclick = () => checkInput(button, challenge.answer);
                taskDiv.appendChild(input);
                taskDiv.appendChild(button);
            } else if (actId === 'act10') {
                p.textContent = challenge.task;
                const textarea = document.createElement('textarea');
                textarea.placeholder = 'Tape ici';
                const button = document.createElement('button');
                button.textContent = 'Vérifier';
                button.onclick = () => checkSentence(button);
                taskDiv.appendChild(textarea);
                taskDiv.appendChild(button);
            }
        }
    </script>
</body>
</html>