<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Méthodo Prépas : L’Épopée Dissertation</title>
    <style>
        :root {
            --primary-blue: #1e3a8a;
            --secondary-green: #10b981;
            --accent-orange: #f97316;
            --light-bg: #f1f5f9;
            --white: #ffffff;
            --shadow: rgba(0, 0, 0, 0.1);
            --text-dark: #1f2937;
            --purple: #8b5cf6;
            --pink: #ec4899;
            --gold: #eab308;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: var(--light-bg);
            margin: 0;
            padding: 0;
            color: var(--text-dark);
            line-height: 1.6;
        }

        header {
            background: linear-gradient(135deg, var(--primary-blue), #3b82f6);
            color: var(--white);
            text-align: center;
            padding: 40px 20px;
            box-shadow: 0 4px 12px var(--shadow);
        }

        h1 { margin: 0; font-size: 48px; font-weight: 800; }
        p.subtitle { font-size: 22px; margin: 10px 0; opacity: 0.9; }
        .container { max-width: 1100px; margin: 20px auto; padding: 20px; }

        .gamification-bar {
            background: linear-gradient(to right, var(--primary-blue), var(--purple));
            color: var(--white);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 25px;
            box-shadow: 0 3px 10px var(--shadow);
        }

        .gamification-bar span { margin: 0 20px; font-weight: bold; font-size: 18px; }
        .progress-bar { width: 90%; margin: 15px auto; background: #e5e7eb; height: 25px; border-radius: 12px; overflow: hidden; border: 2px solid var(--gold); }
        .progress { height: 100%; background: linear-gradient(to right, var(--secondary-green), var(--accent-orange)); width: 0; transition: width 0.6s ease; }
        .badge { background: var(--gold); color: var(--text-dark); padding: 6px 14px; border-radius: 20px; font-size: 14px; margin: 5px; display: inline-block; }

        .button-container { display: flex; justify-content: center; gap: 15px; margin: 30px 0; flex-wrap: wrap; }
        button { padding: 12px 25px; font-size: 16px; font-weight: 600; color: var(--white); border: none; border-radius: 8px; cursor: pointer; transition: transform 0.2s, opacity 0.2s; box-shadow: 0 2px 5px var(--shadow); }
        button:hover { transform: scale(1.06); opacity: 0.95; }
        button.sci { background: var(--secondary-green); }
        button.com { background: var(--accent-orange); }
        button.dissertations { background: var(--primary-blue); }
        button.summary { background: var(--purple); }
        button.verify-button { background: var(--accent-orange); }
        button.next-button { background: var(--secondary-green); }

        .section { display: none; background: var(--white); padding: 20px; border-radius: 12px; box-shadow: 0 5px 15px var(--shadow); margin-top: 25px; }
        .section.active { display: block; }
        .sub-section { display: none; }
        .sub-section.active { display: block; }

        .game-step { margin: 20px 0; padding: 20px; background: var(--white); border-radius: 10px; box-shadow: 0 4px 10px var(--shadow); transition: transform 0.2s; }
        .game-step:hover { transform: translateY(-2px); }
        .game-step h3 { color: var(--primary-blue); }
        #step-citations { border-left: 6px solid var(--secondary-green); }
        #step-analysis { border-left: 6px solid var(--purple); }
        #step-problem { border-left: 6px solid var(--primary-blue); }
        #step-plan { border-left: 6px solid var(--accent-orange); }
        #step-intro { border-left: 6px solid var(--pink); }
        #step-part1 { border-left: 6px solid var(--gold); }
        #step-part2 { border-left: 6px solid #3b82f6; }
        #step-part3 { border-left: 6px solid #10b981; }
        #step-conclusion { border-left: 6px solid var(--purple); }

        .feedback { background: #fef3c7; padding: 15px; margin: 10px 0; border-radius: 8px; border: 2px solid var(--gold); font-weight: 500; display: none; }
        .works-reference { background: #dbeafe; padding: 15px; border-radius: 8px; text-align: center; font-weight: bold; margin: 20px 0; border-left: 5px solid var(--primary-blue); }

        footer { text-align: center; padding: 25px; background: var(--primary-blue); color: var(--white); font-size: 16px; margin-top: 50px; border-top: 5px solid var(--secondary-green); }
        select, input, textarea { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #d1d5db; border-radius: 8px; font-size: 16px; box-sizing: border-box; }

        @media (max-width: 768px) {
            h1 { font-size: 32px; }
            p.subtitle { font-size: 18px; }
            .button-container { gap: 10px; }
            button { padding: 10px 20px; font-size: 14px; }
            .gamification-bar span { font-size: 16px; margin: 0 10px; }
            .game-step { padding: 15px; }
        }
    </style>
</head>
<body>
    <header>
        <h1>Méthodo Prépas : L’Épopée Dissertation</h1>
        <p class="subtitle">De Novice à Légende des Concours : Maîtrisez les Épreuves !</p>
    </header>
    <div class="container">
        <div class="gamification-bar">
            <span id="player-level">Niveau : Novice (1)</span> |
            <span id="player-points">Points : 0</span> |
            <span id="badges">Badges : Aucun</span>
            <div class="progress-bar">
                <div class="progress" id="progress"></div>
            </div>
        </div>

        <div id="home" class="section active">
            <h2>Bienvenue, Aspirant Penseur !</h2>
            <p>Choisissez votre filière pour débuter l’épopée :</p>
            <div class="button-container">
                <button class="sci" onclick="showSection('sci')">Prépas Scientifiques</button>
                <button class="com" onclick="showSection('com')">Prépas Commerciales</button>
            </div>
        </div>

        <div id="sci" class="section">
            <h2>Prépas Scientifiques - Individu et Communauté</h2>
            <p>Forgez vos compétences pour les concours :</p>
            <div class="button-container">
                <button class="dissertations" onclick="showSubSection('sci-diss')">Dissertations</button>
                <button class="summary" onclick="showSubSection('sci-res')">Résumés</button>
            </div>

            <div id="sci-diss" class="sub-section">
                <h2>Dissertation : La Quête du Savoir</h2>
                <div class="works-reference">Œuvres : <em>Eschyle (Les Sept, Les Suppliantes)</em>, <em>Spinoza (Traité Théologicopolitique)</em>, <em>Wharton (Le Temps de l’innocence)</em></div>

                <div class="game-step" id="step-citations">
                    <h3>Niveau 1 : Maître des Citations</h3>
                    <p>Associez ces arguments aux auteurs (10 points) :</p>
                    <div id="quote-container"></div>
                    <button class="verify-button" onclick="checkQuotes()">Vérifier</button>
                    <button class="next-button" onclick="generateQuoteGame()">Nouveau Défi</button>
                    <div id="quote-feedback" class="feedback"></div>
                </div>

                <div class="game-step" id="step-analysis">
                    <h3>Niveau 2 : Analyseur de Citations</h3>
                    <p>Analysez cette citation (15 points) :</p>
                    <div id="analysis-container"></div>
                    <button class="verify-button" onclick="checkAnalysis()">Vérifier</button>
                    <button class="next-button" onclick="generateAnalysisGame()">Nouveau Défi</button>
                    <div id="analysis-feedback" class="feedback"></div>
                </div>

                <div class="game-step" id="step-problem">
                    <h3>Niveau 3 : Forger une Problématique</h3>
                    <p>Rédigez une problématique (20 points) :</p>
                    <div id="problem-container"></div>
                    <textarea id="problem-input" placeholder="Votre problématique..."></textarea>
                    <button class="verify-button" onclick="checkProblem()">Vérifier</button>
                    <button class="next-button" onclick="generateProblemGame()">Nouveau Défi</button>
                    <div id="problem-feedback" class="feedback"></div>
                </div>

                <div class="game-step" id="step-plan">
                    <h3>Niveau 4 : Architecte du Plan</h3>
                    <p>Proposez un plan en 3 parties (25 points) :</p>
                    <div id="plan-container"></div>
                    <textarea id="plan-input" placeholder="Ex. : I. ... II. ... III. ..." maxlength="500"></textarea>
                    <button class="verify-button" onclick="checkPlan()">Vérifier</button>
                    <button class="next-button" onclick="generatePlanGame()">Nouveau Défi</button>
                    <div id="plan-feedback" class="feedback"></div>
                </div>

                <div class="game-step" id="step-intro">
                    <h3>Niveau 5 : Rédacteur d’Introduction</h3>
                    <p>Rédigez une introduction (30 points) :</p>
                    <div id="intro-container"></div>
                    <textarea id="intro-input" placeholder="Votre introduction..." maxlength="1000"></textarea>
                    <button class="verify-button" onclick="checkIntro()">Vérifier</button>
                    <button class="next-button" onclick="generateIntroGame()">Nouveau Défi</button>
                    <div id="intro-feedback" class="feedback"></div>
                </div>

                <div class="game-step" id="step-part1">
                    <h3>Niveau 6 : Développeur de la Première Partie</h3>
                    <p>Rédigez la première partie (40 points) :</p>
                    <div id="part1-container"></div>
                    <textarea id="part1-input" placeholder="Votre première partie..." maxlength="1500"></textarea>
                    <button class="verify-button" onclick="checkPart1()">Vérifier</button>
                    <button class="next-button" onclick="generatePart1Game()">Nouveau Défi</button>
                    <div id="part1-feedback" class="feedback"></div>
                </div>

                <div class="game-step" id="step-part2">
                    <h3>Niveau 7 : Développeur de la Deuxième Partie</h3>
                    <p>Rédigez la deuxième partie (45 points) :</p>
                    <div id="part2-container"></div>
                    <textarea id="part2-input" placeholder="Votre deuxième partie..." maxlength="1500"></textarea>
                    <button class="verify-button" onclick="checkPart2()">Vérifier</button>
                    <button class="next-button" onclick="generatePart2Game()">Nouveau Défi</button>
                    <div id="part2-feedback" class="feedback"></div>
                </div>

                <div class="game-step" id="step-part3">
                    <h3>Niveau 8 : Développeur de la Troisième Partie</h3>
                    <p>Rédigez la troisième partie (50 points) :</p>
                    <div id="part3-container"></div>
                    <textarea id="part3-input" placeholder="Votre troisième partie..." maxlength="1500"></textarea>
                    <button class="verify-button" onclick="checkPart3()">Vérifier</button>
                    <button class="next-button" onclick="generatePart3Game()">Nouveau Défi</button>
                    <div id="part3-feedback" class="feedback"></div>
                </div>

                <div class="game-step" id="step-conclusion">
                    <h3>Niveau 9 : Maître de la Conclusion</h3>
                    <p>Rédigez la conclusion (60 points) :</p>
                    <div id="conclusion-container"></div>
                    <textarea id="conclusion-input" placeholder="Votre conclusion..." maxlength="1000"></textarea>
                    <button class="verify-button" onclick="checkConclusion()">Vérifier</button>
                    <button class="next-button" onclick="generateConclusionGame()">Nouveau Défi</button>
                    <div id="conclusion-feedback" class="feedback"></div>
                </div>
            </div>

            <div id="sci-res" class="sub-section">
                <h2>Résumés : La Voie de la Concision</h2>
                <p>Maîtrisez l’art du résumé (20-60 points) :</p>

                <div class="game-step" id="step-thesis">
                    <h3>Niveau 1 : Détective de la Thèse</h3>
                    <p>Trouvez la thèse (20 points) :</p>
                    <div id="thesis-container"></div>
                    <textarea id="thesis-input" placeholder="Écrivez la thèse..." maxlength="200"></textarea>
                    <button class="verify-button" onclick="checkThesis()">Vérifier</button>
                    <button class="next-button" onclick="generateThesisGame()">Nouveau Défi</button>
                    <div id="thesis-feedback" class="feedback"></div>
                </div>

                <div class="game-step" id="step-args">
                    <h3>Niveau 2 : Chercheur d’Arguments</h3>
                    <p>Listez les arguments (25 points) :</p>
                    <div id="args-container"></div>
                    <textarea id="args-input" placeholder="Écrivez les arguments..." maxlength="300"></textarea>
                    <button class="verify-button" onclick="checkArgs()">Vérifier</button>
                    <button class="next-button" onclick="generateArgsGame()">Nouveau Défi</button>
                    <div id="args-feedback" class="feedback"></div>
                </div>

                <div class="game-step" id="step-parts">
                    <h3>Niveau 3 : Architecte des Parties</h3>
                    <p>Identifiez les parties (30 points) :</p>
                    <div id="parts-container"></div>
                    <textarea id="parts-input" placeholder="Écrivez les parties..." maxlength="300"></textarea>
                    <button class="verify-button" onclick="checkParts()">Vérifier</button>
                    <button class="next-button" onclick="generatePartsGame()">Nouveau Défi</button>
                    <div id="parts-feedback" class="feedback"></div>
                </div>

                <div class="game-step" id="step-circuit">
                    <h3>Niveau 4 : Décodeur du Circuit</h3>
                    <p>Analysez le circuit argumentatif (40 points) :</p>
                    <div id="circuit-container"></div>
                    <textarea id="circuit-input" placeholder="Décrivez le circuit..." maxlength="400"></textarea>
                    <button class="verify-button" onclick="checkCircuit()">Vérifier</button>
                    <button class="next-button" onclick="generateCircuitGame()">Nouveau Défi</button>
                    <div id="circuit-feedback" class="feedback"></div>
                </div>

                <div class="game-step" id="step-summary">
                    <h3>Niveau 5 : Maître du Résumé</h3>
                    <p>Résumez en 100 mots (60 points) :</p>
                    <div id="summary-container"></div>
                    <textarea id="summary-input" placeholder="Votre résumé (100 mots max)..." maxlength="500" oninput="countWords('summary-input', 'summary-word-count', 100)"></textarea>
                    <p id="summary-word-count">Mots : 0/100</p>
                    <button class="verify-button" onclick="checkSummary()">Vérifier</button>
                    <button class="next-button" onclick="generateSummaryGame()">Nouveau Défi</button>
                    <div id="summary-feedback" class="feedback"></div>
                </div>
            </div>
        </div>

        <div id="com" class="section">
            <h2>Prépas Commerciales</h2>
            <p>Cette section est en cours de développement. Revenez bientôt !</p>
        </div>
    </div>

    <footer>
        <p>© 2025 Méthodo Prépas - Propulsé par xAI</p>
    </footer>

    <script>
        let playerPoints = 0;
        let playerLevel = 1;
        let badges = [];
        const levelThresholds = [0, 50, 150, 300, 500, 750, 1000, 1300, 1700, 2200];
        let errorCount = {};

        function updateGamification(pointsToAdd, stepId) {
            if (pointsToAdd < 0) {
                errorCount[stepId] = (errorCount[stepId] || 0) + 1;
                if (errorCount[stepId] >= 3) {
                    playerPoints = Math.max(0, playerPoints - 5);
                    alert("Trop d’erreurs consécutives ! -5 points.");
                    errorCount[stepId] = 0;
                }
            } else {
                errorCount[stepId] = 0;
                playerPoints += pointsToAdd;
            }
            const currentThreshold = levelThresholds[playerLevel - 1];
            const nextThreshold = levelThresholds[playerLevel] || levelThresholds[levelThresholds.length - 1];
            const progress = ((playerPoints - currentThreshold) / (nextThreshold - currentThreshold)) * 100;
            document.getElementById("player-points").textContent = `Points : ${playerPoints}`;
            document.getElementById("player-level").textContent = `Niveau : ${getLevelName(playerLevel)} (${playerLevel})`;
            document.getElementById("badges").textContent = `Badges : ${badges.length ? badges.join(", ") : "Aucun"}`;
            document.getElementById("progress").style.width = `${Math.min(progress, 100)}%`;

            if (playerPoints >= nextThreshold && playerLevel < 10) {
                playerLevel++;
                badges.push(`${getLevelName(playerLevel)} Niv. ${playerLevel}`);
                alert(`Triomphe ! Vous êtes ${getLevelName(playerLevel)} (Niveau ${playerLevel}) !`);
            }
        }

        function getLevelName(level) {
            const names = ["Novice", "Apprenant", "Analyseur", "Problématicien", "Planificateur", "Rédacteur", "Développeur I", "Développeur II", "Développeur III", "Légende des Concours"];
            return names[Math.min(level - 1, names.length - 1)];
        }

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
        }

        function showSubSection(subSectionId) {
            const subSection = document.getElementById(subSectionId);
            const mainSection = subSection.closest('.section');
            mainSection.querySelectorAll('.sub-section').forEach(s => s.classList.remove('active'));
            subSection.classList.add('active');
            if (subSectionId === 'sci-diss') {
                generateQuoteGame();
                generateAnalysisGame();
                generateProblemGame();
                generatePlanGame();
                generateIntroGame();
                generatePart1Game();
                generatePart2Game();
                generatePart3Game();
                generateConclusionGame();
            } else if (subSectionId === 'sci-res') {
                generateThesisGame();
                generateArgsGame();
                generatePartsGame();
                generateCircuitGame();
                generateSummaryGame();
            }
        }

        function countWords(inputId, countId, max) {
            const text = document.getElementById(inputId).value.trim();
            const wordCount = text ? text.split(/\s+/).length : 0;
            document.getElementById(countId).textContent = `Mots : ${wordCount}/${max}`;
        }

        function hideFeedback(feedbackId) {
            setTimeout(() => {
                document.getElementById(feedbackId).style.display = "none";
            }, 5000);
        }

        // Données pour SCI-DISS
        const quotes = [
            { text: "Pélasgos incarne l'individu au service de sa communauté.", author: "Eschyle", work: "Les Suppliantes" },
            { text: "Étéocle oscille entre dévouement et tyrannie potentielle.", author: "Eschyle", work: "Les Sept contre Thèbes" },
            { text: "La liberté de pensée est essentielle pour la piété.", author: "Spinoza", work: "Traité Théologicopolitique" },
            { text: "Newland est tiraillé entre individu et société.", author: "Wharton", work: "Le Temps de l’innocence" }
        ];

        const analysisData = [
            { quote: "La conscience que nous avons de nous-mêmes en tant que société, et la conscience que nous avons de nous-mêmes en tant qu’individus, ne coïncident jamais tout à fait (Norbert Elias)", keywords: ["conscience", "société", "individu"], reformulation: "La perception de soi diffère entre l’individu et le collectif." },
            { quote: "Le lien social est à la fois une force et une entrave (Durkheim)", keywords: ["lien", "force", "entrave"], reformulation: "Les relations sociales soutiennent mais limitent." },
            { quote: "L’individu n’existe qu’à travers le regard des autres (Sartre)", keywords: ["individu", "regard", "autres"], reformulation: "L’identité dépend du collectif." }
        ];

        const problemData = [
            { quote: "La conscience que nous avons de nous-mêmes en tant que société, et la conscience que nous avons de nous-mêmes en tant qu’individus, ne coïncident jamais tout à fait (Norbert Elias)", problem: "Comment concilier la conscience individuelle et collective ?" },
            { quote: "Le lien social est à la fois une force et une entrave (Durkheim)", problem: "Dans quelle mesure le lien social libère-t-il ou enferme-t-il l’individu ?" },
            { quote: "L’individu n’existe qu’à travers le regard des autres (Sartre)", problem: "L’individu peut-il se définir hors du regard collectif ?" }
        ];

        const planData = [
            { quote: "La conscience que nous avons de nous-mêmes en tant que société, et la conscience que nous avons de nous-mêmes en tant qu’individus, ne coïncident jamais tout à fait (Norbert Elias)", keywords: ["conscience", "tension", "harmonie"] },
            { quote: "Le lien social est à la fois une force et une entrave (Durkheim)", keywords: ["lien", "force", "limite"] },
            { quote: "L’individu n’existe qu’à travers le regard des autres (Sartre)", keywords: ["identité", "autrui", "autonomie"] }
        ];

        const introData = [
            { quote: "La conscience que nous avons de nous-mêmes en tant que société, et la conscience que nous avons de nous-mêmes en tant qu’individus, ne coïncident jamais tout à fait (Norbert Elias)", problem: "Comment concilier la conscience individuelle et collective ?", planKeywords: ["conscience", "tension", "harmonie"], works: ["Eschyle", "Spinoza", "Wharton"] },
            { quote: "Le lien social est à la fois une force et une entrave (Durkheim)", problem: "Dans quelle mesure le lien social libère-t-il ou enferme-t-il l’individu ?", planKeywords: ["lien", "force", "limite"], works: ["Eschyle", "Spinoza", "Wharton"] },
            { quote: "L’individu n’existe qu’à travers le regard des autres (Sartre)", problem: "L’individu peut-il se définir hors du regard collectif ?", planKeywords: ["identité", "autrui", "autonomie"], works: ["Eschyle", "Spinoza", "Wharton"] }
        ];

        const part1Data = [
            { quote: "La conscience que nous avons de nous-mêmes en tant que société, et la conscience que nous avons de nous-mêmes en tant qu’individus, ne coïncident jamais tout à fait (Norbert Elias)", idea: "La conscience collective domine", introPartial: "La communauté forge une identité.", subParts: ["Protection dans Les Suppliantes", "Soutien ambigu dans Wharton", "Pacte sécurisant chez Spinoza"], conclusionPartial: "Mais la conscience individuelle résiste." },
            { quote: "Le lien social est à la fois une force et une entrave (Durkheim)", idea: "La force du collectif", introPartial: "Le lien unit les individus.", subParts: ["Solidarité chez Eschyle", "Règles chez Spinoza", "Normes chez Wharton"], conclusionPartial: "Mais il impose des contraintes." },
            { quote: "L’individu n’existe qu’à travers le regard des autres (Sartre)", idea: "L’identité par autrui", introPartial: "Le regard collectif façonne.", subParts: ["Devoir chez Eschyle", "Jugement chez Wharton", "Raison chez Spinoza"], conclusionPartial: "Mais l’individu cherche à s’émanciper." }
        ];

        const part2Data = [
            { quote: "La conscience que nous avons de nous-mêmes en tant que société, et la conscience que nous avons de nous-mêmes en tant qu’individus, ne coïncident jamais tout à fait (Norbert Elias)", idea: "La tension persiste", introPartial: "Le décalage crée des conflits.", subParts: ["Oppression dans Wharton", "Conflit chez Eschyle", "Limite chez Spinoza"], conclusionPartial: "La tension appelle une résolution." },
            { quote: "Le lien social est à la fois une force et une entrave (Durkheim)", idea: "Les limites du lien", introPartial: "Les règles étouffent.", subParts: ["Tyrannie chez Eschyle", "Conformité chez Wharton", "Contrôle chez Spinoza"], conclusionPartial: "Mais l’individu résiste." },
            { quote: "L’individu n’existe qu’à travers le regard des autres (Sartre)", idea: "Conflit intérieur", introPartial: "Le regard oppresse.", subParts: ["Poids chez Wharton", "Devoir chez Eschyle", "Critique chez Spinoza"], conclusionPartial: "L’autonomie reste fragile." }
        ];

        const part3Data = [
            { quote: "La conscience que nous avons de nous-mêmes en tant que société, et la conscience que nous avons de nous-mêmes en tant qu’individus, ne coïncident jamais tout à fait (Norbert Elias)", idea: "Une harmonie est possible", introPartial: "Un équilibre peut émerger.", subParts: ["Pacte rationnel chez Spinoza", "Résistance chez Wharton", "Solidarité chez Eschyle"], conclusionPartial: "L’harmonie reste précaire." },
            { quote: "Le lien social est à la fois une force et une entrave (Durkheim)", idea: "Vers un équilibre", introPartial: "La coopération s’ajuste.", subParts: ["Raison chez Spinoza", "Adaptation chez Wharton", "Unité chez Eschyle"], conclusionPartial: "Mais les tensions subsistent." },
            { quote: "L’individu n’existe qu’à travers le regard des autres (Sartre)", idea: "Autonomie partielle", introPartial: "L’individu s’affirme.", subParts: ["Liberté chez Spinoza", "Rejet chez Wharton", "Courage chez Eschyle"], conclusionPartial: "Le regard reste influent." }
        ];

        const conclusionData = [
            { quote: "La conscience que nous avons de nous-mêmes en tant que société, et la conscience que nous avons de nous-mêmes en tant qu’individus, ne coïncident jamais tout à fait (Norbert Elias)", summary: "La conscience collective domine, mais la tension persiste et peut s’harmoniser.", opening: "Comment cette dualité évolue-t-elle aujourd’hui ?" },
            { quote: "Le lien social est à la fois une force et une entrave (Durkheim)", summary: "Le lien soutient mais limite, un équilibre émerge.", opening: "Quel lien social pour demain ?" },
            { quote: "L’individu n’existe qu’à travers le regard des autres (Sartre)", summary: "L’identité dépend d’autrui mais cherche l’autonomie.", opening: "L’individu peut-il s’affranchir ?" }
        ];

        // Fonctions SCI-DISS
        function generateQuoteGame() {
            const container = document.getElementById("quote-container");
            const selected = quotes.sort(() => 0.5 - Math.random()).slice(0, 3);
            container.innerHTML = selected.map((q, i) => `
                <p>${i + 1}. "${q.text}"</p>
                <select id="quote-${i}">
                    <option value="">Choisissez...</option>
                    <option value="Eschyle">Eschyle</option>
                    <option value="Spinoza">Spinoza</option>
                    <option value="Wharton">Wharton</option>
                </select>
            `).join('');
        }

        function checkQuotes() {
            const feedback = document.getElementById("quote-feedback");
            let correct = 0;
            for (let i = 0; i < 3; i++) {
                const select = document.getElementById(`quote-${i}`);
                const text = select.previousElementSibling.textContent.split('"')[1];
                if (select.value === quotes.find(q => q.text === text).author) correct++;
            }
            feedback.style.display = "block";
            if (correct === 3) {
                feedback.innerHTML = "Parfait ! Toutes les citations sont correctes. +10 points.";
                updateGamification(10, "step-citations");
                setTimeout(() => generateQuoteGame(), 2000);
            } else {
                feedback.innerHTML = `${correct}/3 correctes. Étudiez mieux les auteurs !`;
                updateGamification(0, "step-citations");
            }
            hideFeedback("quote-feedback");
        }

        function generateAnalysisGame() {
            const container = document.getElementById("analysis-container");
            const data = analysisData[Math.floor(Math.random() * analysisData.length)];
            container.innerHTML = `
                <p>Citation : "${data.quote}"</p>
                <label>Mots-clés (exactement ${data.keywords.length}) :</label><input id="keywords-input" placeholder="ex. conscience, société...">
                <label>Reformulation :</label><input id="reform-input" placeholder="Reformulez la citation...">
            `;
        }

        function checkAnalysis() {
            const feedback = document.getElementById("analysis-feedback");
            const quote = document.getElementById("analysis-container").querySelector("p").textContent.split('"')[1];
            const data = analysisData.find(d => d.quote === quote);
            const keywords = document.getElementById("keywords-input").value.toLowerCase().split(/,\s*/).filter(k => k);
            const reform = document.getElementById("reform-input").value.toLowerCase().trim();
            const keywordMatch = data.keywords.length === keywords.length && data.keywords.every(k => keywords.includes(k));
            const reformMatch = reform.split(/\s+/).length >= 5 && data.reformulation.toLowerCase().split(" ").every(w => reform.includes(w));
            feedback.style.display = "block";
            if (keywordMatch && reformMatch) {
                feedback.innerHTML = "Analyse précise ! +15 points.";
                updateGamification(15, "step-analysis");
                setTimeout(() => generateAnalysisGame(), 2000);
            } else {
                feedback.innerHTML = `Incorrect. Mots-clés attendus : ${data.keywords.join(", ")}. Reformulation : "${data.reformulation}". Soyez exact !`;
                updateGamification(0, "step-analysis");
            }
            hideFeedback("analysis-feedback");
        }

        function generateProblemGame() {
            const container = document.getElementById("problem-container");
            const data = problemData[Math.floor(Math.random() * problemData.length)];
            container.innerHTML = `<p>Citation : "${data.quote}"</p>`;
            document.getElementById("problem-input").value = "";
        }

        function checkProblem() {
            const feedback = document.getElementById("problem-feedback");
            const quote = document.getElementById("problem-container").querySelector("p").textContent.split('"')[1];
            const data = problemData.find(d => d.quote === quote);
            const input = document.getElementById("problem-input").value.toLowerCase().trim();
            const isCorrect = input.includes("individu") && input.includes("communauté") && input.endsWith("?") && input.split(/\s+/).length >= 8 && data.problem.toLowerCase().split(" ").every(w => input.includes(w));
            feedback.style.display = "block";
            if (isCorrect) {
                feedback.innerHTML = "Problématique rigoureuse ! +20 points.";
                updateGamification(20, "step-problem");
                setTimeout(() => generateProblemGame(), 2000);
            } else {
                feedback.innerHTML = `Insuffisant. Exemple : "${data.problem}". Doit inclure "individu", "communauté", finir par "?" et refléter la citation (8+ mots).`;
                updateGamification(0, "step-problem");
            }
            hideFeedback("problem-feedback");
        }

        function generatePlanGame() {
            const container = document.getElementById("plan-container");
            const data = planData[Math.floor(Math.random() * planData.length)];
            container.innerHTML = `<p>Citation : "${data.quote}"</p>`;
            document.getElementById("plan-input").value = "";
        }

        function checkPlan() {
            const feedback = document.getElementById("plan-feedback");
            const quote = document.getElementById("plan-container").querySelector("p").textContent.split('"')[1];
            const data = planData.find(d => d.quote === quote);
            const input = document.getElementById("plan-input").value.toLowerCase().trim();
            const parts = input.split(/i{1,3}\.\s/).filter(p => p);
            const hasThreeParts = parts.length === 3 && parts.every(p => p.split(/\s+/).length >= 5);
            const hasKeywords = data.keywords.every(k => input.includes(k));
            const hasWorks = ["eschyle", "spinoza", "wharton"].some(w => input.includes(w));
            feedback.style.display = "block";
            if (hasThreeParts && hasKeywords && hasWorks) {
                feedback.innerHTML = "Plan structuré et pertinent ! +25 points.";
                updateGamification(25, "step-plan");
                setTimeout(() => generatePlanGame(), 2000);
            } else {
                feedback.innerHTML = `Incomplet. Besoin de : 3 parties (I., II., III., 5+ mots chacune), mots-clés (${data.keywords.join(", ")}), et une œuvre (Eschyle, Spinoza, Wharton).`;
                updateGamification(0, "step-plan");
            }
            hideFeedback("plan-feedback");
        }

        function generateIntroGame() {
            const container = document.getElementById("intro-container");
            const data = introData[Math.floor(Math.random() * introData.length)];
            container.innerHTML = `<p>Citation : "${data.quote}"</p>`;
            document.getElementById("intro-input").value = "";
        }

        function checkIntro() {
            const feedback = document.getElementById("intro-feedback");
            const quote = document.getElementById("intro-container").querySelector("p").textContent.split('"')[1];
            const data = introData.find(d => d.quote === quote);
            const input = document.getElementById("intro-input").value.toLowerCase().trim();
            const hasAmorce = ["depuis", "histoire", "société"].some(w => input.includes(w));
            const hasCitation = input.includes(quote.toLowerCase().substring(0, 20));
            const hasProblem = input.includes("individu") && input.includes("communauté") && input.includes("?") && data.problem.toLowerCase().split(" ").every(w => input.includes(w));
            const hasPlan = data.planKeywords.every(k => input.includes(k));
            const hasWorks = data.works.every(w => input.includes(w.toLowerCase()));
            const isLongEnough = input.split(/\s+/).length >= 80;
            feedback.style.display = "block";
            if (hasAmorce && hasCitation && hasProblem && hasPlan && hasWorks && isLongEnough) {
                feedback.innerHTML = "Introduction exemplaire ! +30 points.";
                updateGamification(30, "step-intro");
                setTimeout(() => generateIntroGame(), 2000);
            } else {
                feedback.innerHTML = `Incomplet. Besoin de : amorce (contexte), citation (${quote.substring(0, 20)}...), problématique (${data.problem}), plan (${data.planKeywords.join(", ")}), œuvres (${data.works.join(", ")}), et 80+ mots.`;
                updateGamification(0, "step-intro");
            }
            hideFeedback("intro-feedback");
        }

        function generatePart1Game() {
            const container = document.getElementById("part1-container");
            const data = part1Data[Math.floor(Math.random() * part1Data.length)];
            const randomArgs = quotes.sort(() => 0.5 - Math.random()).slice(0, 3).map(q => q.text);
            container.innerHTML = `
                <p>Citation : "${data.quote}"</p>
                <p>Idée : ${data.idea}</p>
                <p>Intro partielle : ${data.introPartial}</p>
                <p>Sous-parties suggérées : ${randomArgs.join(", ")}</p>
                <p>Conclusion partielle : ${data.conclusionPartial}</p>
            `;
            document.getElementById("part1-input").value = "";
        }

        function checkPart1() {
            const feedback = document.getElementById("part1-feedback");
            const input = document.getElementById("part1-input").value.toLowerCase().trim();
            const quote = document.getElementById("part1-container").querySelector("p").textContent.split('"')[1];
            const data = part1Data.find(d => d.quote === quote);
            const hasIntro = input.includes(data.introPartial.toLowerCase());
            const hasSubParts = data.subParts.every(sp => input.includes(sp.toLowerCase().split(" ")[0]));
            const hasConclusion = input.includes(data.conclusionPartial.toLowerCase());
            const isLongEnough = input.split(/\s+/).length >= 120;
            feedback.style.display = "block";
            if (hasIntro && hasSubParts && hasConclusion && isLongEnough) {
                feedback.innerHTML = "Première partie solide ! +40 points.";
                updateGamification(40, "step-part1");
                setTimeout(() => generatePart1Game(), 2000);
            } else {
                feedback.innerHTML = `Insuffisant. Besoin de : intro (${data.introPartial}), sous-parties (${data.subParts.join(", ")}), conclusion (${data.conclusionPartial}), et 120+ mots.`;
                updateGamification(0, "step-part1");
            }
            hideFeedback("part1-feedback");
        }

        function generatePart2Game() {
            const container = document.getElementById("part2-container");
            const data = part2Data[Math.floor(Math.random() * part2Data.length)];
            const randomArgs = quotes.sort(() => 0.5 - Math.random()).slice(0, 3).map(q => q.text);
            container.innerHTML = `
                <p>Citation : "${data.quote}"</p>
                <p>Idée : ${data.idea}</p>
                <p>Intro partielle : ${data.introPartial}</p>
                <p>Sous-parties suggérées : ${randomArgs.join(", ")}</p>
                <p>Conclusion partielle : ${data.conclusionPartial}</p>
            `;
            document.getElementById("part2-input").value = "";
        }

        function checkPart2() {
            const feedback = document.getElementById("part2-feedback");
            const input = document.getElementById("part2-input").value.toLowerCase().trim();
            const quote = document.getElementById("part2-container").querySelector("p").textContent.split('"')[1];
            const data = part2Data.find(d => d.quote === quote);
            const hasIntro = input.includes(data.introPartial.toLowerCase());
            const hasSubParts = data.subParts.every(sp => input.includes(sp.toLowerCase().split(" ")[0]));
            const hasConclusion = input.includes(data.conclusionPartial.toLowerCase());
            const isLongEnough = input.split(/\s+/).length >= 120;
            feedback.style.display = "block";
            if (hasIntro && hasSubParts && hasConclusion && isLongEnough) {
                feedback.innerHTML = "Deuxième partie robuste ! +45 points.";
                updateGamification(45, "step-part2");
                setTimeout(() => generatePart2Game(), 2000);
            } else {
                feedback.innerHTML = `Incomplet. Besoin de : intro (${data.introPartial}), sous-parties (${data.subParts.join(", ")}), conclusion (${data.conclusionPartial}), et 120+ mots.`;
                updateGamification(0, "step-part2");
            }
            hideFeedback("part2-feedback");
        }

        function generatePart3Game() {
            const container = document.getElementById("part3-container");
            const data = part3Data[Math.floor(Math.random() * part3Data.length)];
            const randomArgs = quotes.sort(() => 0.5 - Math.random()).slice(0, 3).map(q => q.text);
            container.innerHTML = `
                <p>Citation : "${data.quote}"</p>
                <p>Idée : ${data.idea}</p>
                <p>Intro partielle : ${data.introPartial}</p>
                <p>Sous-parties suggérées : ${randomArgs.join(", ")}</p>
                <p>Conclusion partielle : ${data.conclusionPartial}</p>
            `;
            document.getElementById("part3-input").value = "";
        }

        function checkPart3() {
            const feedback = document.getElementById("part3-feedback");
            const input = document.getElementById("part3-input").value.toLowerCase().trim();
            const quote = document.getElementById("part3-container").querySelector("p").textContent.split('"')[1];
            const data = part3Data.find(d => d.quote === quote);
            const hasIntro = input.includes(data.introPartial.toLowerCase());
            const hasSubParts = data.subParts.every(sp => input.includes(sp.toLowerCase().split(" ")[0]));
            const hasConclusion = input.includes(data.conclusionPartial.toLowerCase());
            const isLongEnough = input.split(/\s+/).length >= 120;
            feedback.style.display = "block";
            if (hasIntro && hasSubParts && hasConclusion && isLongEnough) {
                feedback.innerHTML = "Troisième partie impeccable ! +50 points.";
                updateGamification(50, "step-part3");
                setTimeout(() => generatePart3Game(), 2000);
            } else {
                feedback.innerHTML = `Insuffisant. Besoin de : intro (${data.introPartial}), sous-parties (${data.subParts.join(", ")}), conclusion (${data.conclusionPartial}), et 120+ mots.`;
                updateGamification(0, "step-part3");
            }
            hideFeedback("part3-feedback");
        }

        function generateConclusionGame() {
            const container = document.getElementById("conclusion-container");
            const data = conclusionData[Math.floor(Math.random() * conclusionData.length)];
            container.innerHTML = `
                <p>Citation : "${data.quote}"</p>
                <p>Résumé des parties : ${data.summary}</p>
                <p>Ouverture : ${data.opening}</p>
            `;
            document.getElementById("conclusion-input").value = "";
        }

        function checkConclusion() {
            const feedback = document.getElementById("conclusion-feedback");
            const input = document.getElementById("conclusion-input").value.toLowerCase().trim();
            const quote = document.getElementById("conclusion-container").querySelector("p").textContent.split('"')[1];
            const data = conclusionData.find(d => d.quote === quote);
            const hasSummary = data.summary.toLowerCase().split(" ").every(w => input.includes(w)) && ["eschyle", "spinoza", "wharton"].every(w => input.includes(w));
            const hasOpening = input.includes(data.opening.toLowerCase());
            const isLongEnough = input.split(/\s+/).length >= 60;
            feedback.style.display = "block";
            if (hasSummary && hasOpening && isLongEnough) {
                feedback.innerHTML = "Conclusion magistrale ! +60 points.";
                updateGamification(60, "step-conclusion");
                setTimeout(() => generateConclusionGame(), 2000);
            } else {
                feedback.innerHTML = `Incomplet. Besoin de : résumé (${data.summary}), ouverture (${data.opening}), œuvres (Eschyle, Spinoza, Wharton), et 60+ mots.`;
                updateGamification(0, "step-conclusion");
            }
            hideFeedback("conclusion-feedback");
        }

        // Données pour SCI-RES (Résumés)
        const summaryTexts = [
            {
                text: "Depuis l’aube de l’humanité, l’individu a cherché dans la communauté un refuge face aux aléas de l’existence. Les premières sociétés humaines, des chasseurs-cueilleurs aux cités antiques, ont survécu grâce à une solidarité implacable : un individu seul ne pouvait affronter les bêtes sauvages ou les famines. Cette entraide a forgé des liens puissants, visibles dans les rites collectifs ou les travaux communs, où chacun trouvait sa place au sein d’un tout protecteur. Historiquement, la communauté a été un rempart contre l’incertitude, offrant sécurité physique et affective là où la solitude menait à la perdition. Les récits mythiques, comme ceux des cités grecques, exaltent cette union sacrée face au chaos extérieur. Cependant, cette force collective a un revers : elle impose des normes qui brident l’individu. Dès qu’une communauté s’organise, elle établit des règles, des hiérarchies, des attentes qui écrasent souvent les désirs personnels. Dans les sociétés traditionnelles, le bien commun prime sur l’aspiration individuelle, transformant l’appartenance en une prison dorée. Aujourd’hui, les réseaux sociaux amplifient ce phénomène : l’individu, sous pression pour se conformer à des standards de beauté ou d’opinion, perd une part de son authenticité. Les codes sociaux, bien que protecteurs, deviennent des chaînes invisibles, limitant la liberté de penser ou d’agir hors des sentiers battus. Cette tension révèle une vérité : la communauté, pour exister, exige parfois le sacrifice de l’unicité. Ainsi, la quête d’un équilibre devient essentielle. Si la communauté offre un cadre vital, elle ne doit pas étouffer l’individu sous son poids. L’histoire montre des tentatives pour concilier ces pôles : des révoltes individuelles aux pactes sociaux rationnels, l’humanité oscille entre union et autonomie. Une société idéale serait celle où l’individu conserve une marge de liberté tout en bénéficiant de la force collective. Cela implique une redéfinition des liens sociaux, où la communauté soutient sans asservir, laissant à chacun la possibilité de s’épanouir. En somme, individu et communauté ne sont pas condamnés à s’opposer, mais à coexister dans une harmonie fragile, où chacun trouve sa juste place.",
                thesis: "La communauté offre un refuge mais limite la liberté individuelle.",
                args: ["Protection historique", "Normes restrictives", "Équilibre nécessaire"],
                parts: ["Refuge communautaire", "Contrainte sociale", "Quête d’équilibre"],
                circuit: ["Cause (protection)", "Opposition (contrainte)", "Concession (équilibre)"]
            },
            {
                text: "La communauté a souvent été célébrée comme un idéal unificateur, une promesse de cohésion face à la dispersion individuelle. Depuis les sociétés primitives, elle incarne une aspiration à l’unité, où les individus se fondent dans un projet commun, comme les cités grecques défendues par leurs héros. Cet idéal a inspiré des récits épiques et des systèmes sociaux où le groupe transcende les égoïsmes, offrant un sens d’appartenance et une force collective. Les utopies, des phalanstères aux kibboutz, témoignent de ce rêve d’une vie harmonieuse où l’individu s’épanouit dans le tout. Ces expériences historiques exaltent la communauté comme un rempart contre la solitude et un vecteur d’identité partagée, où chacun contribue à un bien supérieur. Pourtant, la réalité dément cet idéal avec une violence implacable. Les communautés, dès qu’elles s’organisent, se fissurent sous le poids des conflits internes : luttes de pouvoir, divergences d’intérêts, exclusions des marginaux. Les guerres fratricides, les ostracismes ou les schismes religieux montrent que l’unité reste une illusion, brisée par la diversité humaine. Même dans les sociétés modernes, les tentatives de cohésion – nationalismes ou réseaux sociaux – engendrent autant de divisions que d’unions, révélant la fragilité du collectif face aux passions individuelles. Face à cette désillusion, la communauté apparaît comme une fiction nécessaire, un mythe mobilisateur. Si elle ne peut atteindre une harmonie parfaite, elle reste un horizon vers lequel tendre, un récit qui donne sens à la coexistence malgré les fractures. Les individus, tiraillés entre égoïsme et besoin d’appartenance, s’accrochent à cette idée pour surmonter leurs différends, comme un idéal qui transcende la réalité. En somme, la communauté est un paradoxe : une illusion séduisante mais irréalisable, pourtant essentielle pour structurer la vie sociale et donner à l’individu un cadre où exister.",
                thesis: "La communauté est une fiction séduisante mais irréalisable.",
                args: ["Idéal historique", "Conflits réels", "Fiction nécessaire"],
                parts: ["Idéal communautaire", "Réalité conflictuelle", "Fiction mobilisatrice"],
                circuit: ["Cause (idéal)", "Opposition (réalité)", "Synthèse (fiction)"]
            },
            {
                text: "L’idée que l’individu doive se sacrifier pour la communauté a traversé les âges, portée par des visions héroïques et des impératifs collectifs. Dans les cités antiques, comme Sparte ou Athènes, le citoyen était prêt à mourir pour défendre la polis, incarnation d’un devoir sacré. Ce sacrifice, exalté dans les épopées, forgeait la grandeur des nations : un individu offrait sa vie pour la survie du groupe, assurant la pérennité des valeurs communes. Cette logique trouve écho dans les guerres modernes, où les soldats tombent pour la patrie, symbolisant une transcendance de l’égoïsme au profit du bien commun. La communauté, en retour, glorifie ces héros, leur offrant une reconnaissance qui dépasse leur existence éphémère. Cependant, ce sacrifice a un coût humain dévastateur. L’individu, en s’effaçant pour la collectivité, perd sa liberté, ses rêves, parfois sa vie. Les récits de guerre montrent des destins brisés, des familles endeuillées, des consciences écrasées par un devoir imposé. Dans les sociétés autoritaires, ce principe devient une arme : l’individu est réduit à un pion, sa valeur intrinsèque niée au nom d’un collectif oppressif. Même dans des contextes moins extrêmes, le conformisme social peut exiger des renoncements silencieux, étouffant les aspirations personnelles sous le poids des attentes. Ainsi, la question éthique surgit : le sacrifice individuel est-il toujours justifié ? Si la communauté bénéficie de ces actes, elle doit aussi préserver la dignité de chacun. L’histoire montre des résistances, des individus réclamant leur droit à exister face à l’absolutisme collectif. Une société équilibrée pourrait honorer le sacrifice sans l’exiger aveuglément, reconnaissant que l’individu n’est pas qu’un moyen, mais une fin en soi. En définitive, le sacrifice renforce la communauté, mais au prix d’une perte qui interroge sa légitimité.",
                thesis: "Le sacrifice individuel renforce la communauté mais le détruit.",
                args: ["Devoir héroïque", "Perte personnelle", "Réflexion éthique"],
                parts: ["Sacrifice pour la cité", "Coût humain", "Questionnement moral"],
                circuit: ["Cause (devoir)", "Conséquence (perte)", "Questionnement (éthique)"]
            }
        ];

        // Fonctions SCI-RES
        function generateThesisGame() {
            const container = document.getElementById("thesis-container");
            const data = summaryTexts[Math.floor(Math.random() * summaryTexts.length)];
            container.innerHTML = `<p>${data.text}</p>`;
            document.getElementById("thesis-input").value = "";
        }

        function checkThesis() {
            const feedback = document.getElementById("thesis-feedback");
            const input = document.getElementById("thesis-input").value.toLowerCase().trim();
            const text = document.getElementById("thesis-container").textContent;
            const data = summaryTexts.find(t => t.text === text);
            const isCorrect = input === data.thesis.toLowerCase();
            feedback.style.display = "block";
            if (isCorrect) {
                feedback.innerHTML = "Thèse exacte ! +20 points.";
                updateGamification(20, "step-thesis");
                setTimeout(() => generateThesisGame(), 2000);
            } else {
                feedback.innerHTML = `Faux. Thèse attendue : "${data.thesis}". Soyez précis !`;
                updateGamification(0, "step-thesis");
            }
            hideFeedback("thesis-feedback");
        }

        function generateArgsGame() {
            const container = document.getElementById("args-container");
            const data = summaryTexts[Math.floor(Math.random() * summaryTexts.length)];
            container.innerHTML = `<p>${data.text}</p>`;
            document.getElementById("args-input").value = "";
        }

        function checkArgs() {
            const feedback = document.getElementById("args-feedback");
            const input = document.getElementById("args-input").value.toLowerCase().trim().split(/,\s*/).filter(a => a);
            const text = document.getElementById("args-container").textContent;
            const data = summaryTexts.find(t => t.text === text);
            const isCorrect = input.length === 3 && data.args.every((arg, i) => input[i] === arg.toLowerCase());
            feedback.style.display = "block";
            if (isCorrect) {
                feedback.innerHTML = "Arguments parfaits ! +25 points.";
                updateGamification(25, "step-args");
                setTimeout(() => generateArgsGame(), 2000);
            } else {
                feedback.innerHTML = `Incorrect. Arguments attendus : ${data.args.join(", ")}. Listez-les exactement dans l’ordre !`;
                updateGamification(0, "step-args");
            }
            hideFeedback("args-feedback");
        }

        function generatePartsGame() {
            const container = document.getElementById("parts-container");
            const data = summaryTexts[Math.floor(Math.random() * summaryTexts.length)];
            container.innerHTML = `<p>${data.text}</p>`;
            document.getElementById("parts-input").value = "";
        }

        function checkParts() {
            const feedback = document.getElementById("parts-feedback");
            const input = document.getElementById("parts-input").value.toLowerCase().trim().split(/,\s*/).filter(p => p);
            const text = document.getElementById("parts-container").textContent;
            const data = summaryTexts.find(t => t.text === text);
            const isCorrect = input.length === 3 && data.parts.every((part, i) => input[i] === part.toLowerCase());
            feedback.style.display = "block";
            if (isCorrect) {
                feedback.innerHTML = "Parties bien identifiées ! +30 points.";
                updateGamification(30, "step-parts");
                setTimeout(() => generatePartsGame(), 2000);
            } else {
                feedback.innerHTML = `Faux. Parties attendues : ${data.parts.join(", ")}. Soyez exact !`;
                updateGamification(0, "step-parts");
            }
            hideFeedback("parts-feedback");
        }

        function generateCircuitGame() {
            const container = document.getElementById("circuit-container");
            const data = summaryTexts[Math.floor(Math.random() * summaryTexts.length)];
            container.innerHTML = `<p>${data.text}</p>`;
            document.getElementById("circuit-input").value = "";
        }

        function checkCircuit() {
            const feedback = document.getElementById("circuit-feedback");
            const input = document.getElementById("circuit-input").value.toLowerCase().trim().split(/,\s*/).filter(c => c);
            const text = document.getElementById("circuit-container").textContent;
            const data = summaryTexts.find(t => t.text === text);
            const isCorrect = input.length === 3 && data.circuit.every((link, i) => input[i] === link.toLowerCase());
            feedback.style.display = "block";
            if (isCorrect) {
                feedback.innerHTML = "Circuit précis ! +40 points.";
                updateGamification(40, "step-circuit");
                setTimeout(() => generateCircuitGame(), 2000);
            } else {
                feedback.innerHTML = `Incorrect. Circuit attendu : ${data.circuit.join(", ")}. Listez les liens dans l’ordre !`;
                updateGamification(0, "step-circuit");
            }
            hideFeedback("circuit-feedback");
        }

        function generateSummaryGame() {
            const container = document.getElementById("summary-container");
            const data = summaryTexts[Math.floor(Math.random() * summaryTexts.length)];
            container.innerHTML = `<p>${data.text}</p>`;
            document.getElementById("summary-input").value = "";
            countWords("summary-input", "summary-word-count", 100);
        }

        function checkSummary() {
            const feedback = document.getElementById("summary-feedback");
            const input = document.getElementById("summary-input").value.toLowerCase().trim();
            const text = document.getElementById("summary-container").textContent;
            const data = summaryTexts.find(t => t.text === text);
            const wordCount = input.split(/\s+/).length;
            const hasThesis = input.includes(data.thesis.toLowerCase());
            const hasArgs = data.args.every(arg => input.includes(arg.toLowerCase().split(" ")[0]));
            const isCorrectLength = wordCount === 100;
            feedback.style.display = "block";
            if (hasThesis && hasArgs && isCorrectLength) {
                feedback.innerHTML = `Résumé parfait (100 mots) ! +60 points.`;
                updateGamification(60, "step-summary");
                setTimeout(() => generateSummaryGame(), 2000);
            } else {
                feedback.innerHTML = `Inexact (${wordCount} mots). Besoin de : thèse exacte ("${data.thesis}"), arguments (${data.args.join(", ")}), et pile 100 mots.`;
                updateGamification(0, "step-summary");
            }
            hideFeedback("summary-feedback");
        }
    </script>
</body>
</html>